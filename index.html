<!doctype html>

<html lang="ms">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Uno Game - Uno No Mercy</title>
  <style>
    :root{--bg:#0b1220;--card:#fff;--accent:#ff3b3b}
    body{font-family:Inter,system-ui,Segoe UI,Roboto,Arial;margin:0;background:linear-gradient(180deg,#071026 0%, #0b1220 100%);color:#e6eef8;min-height:100vh;display:flex;align-items:center;justify-content:center}
    .app{width:100%;max-width:1100px;padding:18px;box-sizing:border-box}
    header{display:flex;align-items:center;justify-content:space-between;margin-bottom:14px}
    h1{margin:0;font-size:20px}
    .controls{display:flex;gap:8px}
    button{background:#132238;border:1px solid rgba(255,255,255,0.06);color:inherit;padding:8px 12px;border-radius:8px;cursor:pointer}
    .layout{display:grid;grid-template-columns:260px 1fr 260px;gap:12px}
    .panel{background:rgba(255,255,255,0.03);padding:12px;border-radius:10px;min-height:320px}
    .panel h3{margin:0 0 8px 0;font-size:14px}
    .hand{display:flex;flex-wrap:wrap;gap:8px}
    .card{width:72px;height:100px;border-radius:8px;background:var(--card);display:flex;align-items:center;justify-content:center;font-weight:700;color:#111;cursor:pointer;box-shadow:0 6px 18px rgba(2,6,23,0.6)}
    .card.small{width:56px;height:78px;font-size:12px}
    .discard{display:flex;gap:12px;align-items:center;justify-content:center}
    .stack{display:flex;flex-direction:column;gap:6px;align-items:center}
    .meta{font-size:13px;color:#9fb1d6}
    .room{display:flex;flex-direction:column;gap:8px}
    input[type=text]{padding:8px;border-radius:8px;border:1px solid rgba(255,255,255,0.06);background:transparent;color:inherit}
    .players-list{display:flex;flex-direction:column;gap:6px}
    .player-row{display:flex;align-items:center;gap:8px;padding:8px;border-radius:8px;background:rgba(255,255,255,0.02)}
    .center-area{display:flex;flex-direction:column;align-items:center;justify-content:center;gap:12px}
    .log{max-height:120px;overflow:auto;padding:8px;background:rgba(255,255,255,0.02);border-radius:8px}
    footer{margin-top:12px;font-size:13px;color:#9fb1d6}
    .big-card{width:96px;height:140px;border-radius:12px}
    .muted{opacity:0.7}
  </style>
</head>
<body>
  <div class="app">
    <header>
      <h1>Uno Game — <span class="muted">Uno No Mercy (versi ringkas)</span></h1>
      <div class="controls">
        <button id="newGameBtn">Mula Game (Local)</button>
        <button id="createRoomBtn">Buat Room (Host)</button>
        <input id="joinCode" placeholder="Masukkan room code (host id)" />
        <button id="joinRoomBtn">Join</button>
      </div>
    </header><div class="layout">
  <div class="panel">
    <h3>Maklumat Room & Multiplayer</h3>
    <div class="room">
      <div class="meta">Room code (host id): <span id="roomCode">-</span></div>
      <div class="meta">Status: <span id="status">idle</span></div>
      <div class="meta">Sambungan: <span id="peersCount">0</span></div>
      <div style="display:flex;gap:8px;margin-top:6px">
        <button id="copyRoom">Salin code</button>
        <button id="leaveBtn">Tinggalkan Room</button>
      </div>
    </div>

    <h3 style="margin-top:12px">Players</h3>
    <div class="players-list" id="players"></div>

    <h3 style="margin-top:12px">Log / Chat</h3>
    <div class="log" id="log"></div>
  </div>

  <div class="panel center-area">
    <div class="meta">Deck: <span id="deckCount">0</span> — Discard: <span id="discardTop">-</span></div>
    <div class="discard">
      <div class="stack">
        <div class="meta">Discard</div>
        <div id="discardCard" class="card big-card">-</div>
      </div>
      <div class="stack">
        <div class="meta">Deck</div>
        <div id="deckCard" class="card big-card">UNO</div>
        <button id="drawBtn">Draw</button>
      </div>
    </div>

    <div style="width:100%;margin-top:12px;display:flex;justify-content:center;gap:12px">
      <div style="text-align:center">
        <div class="meta">Giliran</div>
        <div id="currentPlayer" style="font-weight:700;font-size:16px">-</div>
      </div>
      <div style="text-align:center">
        <div class="meta">Arah</div>
        <div id="direction">→</div>
      </div>
      <div style="text-align:center">
        <div class="meta">Last action</div>
        <div id="lastAction">-</div>
      </div>
    </div>

  </div>

  <div class="panel">
    <h3>Hand Anda</h3>
    <div id="hand" class="hand"></div>

    <h3 style="margin-top:12px">Tindakan</h3>
    <div style="display:flex;gap:8px;margin-top:6px">
      <button id="unoBtn">UNO!</button>
      <button id="passBtn">Pass/Draw</button>
    </div>

    <h3 style="margin-top:12px">Peraturan ringkas (Uno No Mercy)</h3>
    <div class="meta">
      - Peraturan UNO asas (angka, skip, reverse, draw2, wild, wild+4).<br>
      - Stacking: Draw2 boleh ditambah stack, pemain seterusnya tumpu tambah atau draw semua.<br>
      - "No Mercy": jika anda tak tekan UNO sebelum tinggal 1 kad, anda draw 2 sebagai penalti (automatik diperiksa ketika giliran seterusnya).
    </div>
  </div>
</div>

<footer>
  Untuk multiplayer: klik "Buat Room" pada satu browser (host), kongsi room code (host id) kepada kawan.
  Kawan buka file yang sama (GitHub Pages), masukkan code, klik Join.
</footer>

  </div>  <!-- PeerJS CDN for simple P2P signalling (uses PeerServer cloud) -->  <script src="https://unpkg.com/peerjs@1.4.7/dist/peerjs.min.js"></script>  <script>
    // --- Game engine (simplified UNO) ---
    const COLORS = ['red','green','blue','yellow'];
    const ACTIONS = ['skip','reverse','draw2'];
    const UI = {
      hand: document.getElementById('hand'),
      deckCount: document.getElementById('deckCount'),
      discardCard: document.getElementById('discardCard'),
      deckCard: document.getElementById('deckCard'),
      drawBtn: document.getElementById('drawBtn'),
      currentPlayerEl: document.getElementById('currentPlayer'),
      directionEl: document.getElementById('direction'),
      playersEl: document.getElementById('players'),
      logEl: document.getElementById('log'),
      roomCode: document.getElementById('roomCode'),
      status: document.getElementById('status'),
      peersCount: document.getElementById('peersCount'),
      discardTop: document.getElementById('discardTop'),
      lastAction: document.getElementById('lastAction')
    };

    function log(msg){ UI.logEl.innerHTML += `<div>${msg}</div>`; UI.logEl.scrollTop = UI.logEl.scrollHeight }

    function makeDeck(){
      const d = [];
      for(const c of COLORS){
        // numbers
        d.push({type:'number',color:c,value:0});
        for(let n=1;n<=9;n++){ d.push({type:'number',color:c,value:n});d.push({type:'number',color:c,value:n}); }
        // actions
        for(const a of ACTIONS){ d.push({type:a,color:c}); d.push({type:a,color:c}); }
      }
      // wilds
      for(let i=0;i<4;i++){ d.push({type:'wild'}); d.push({type:'wild4'}); }
      return shuffle(d);
    }
    function shuffle(a){ for(let i=a.length-1;i>0;i--){ const j=Math.floor(Math.random()*(i+1)); [a[i],a[j]]=[a[j],a[i]] } return a }

    // --- State ---
    const state = {
      deck: [], discard: [], players: [], turn: 0, dir: 1, lastAction:'-', isGame:false
    };

    function startLocalGame(names=['You','Bot']){
      state.deck = makeDeck(); state.discard = []; state.players = []; state.turn = 0; state.dir=1; state.isGame=true; state.lastAction='Game started';
      for(const n of names){ state.players.push({id:generateId(),name:n,hand:[]}) }
      // deal 7
      for(let i=0;i<7;i++){ state.players.forEach(p=>p.hand.push(state.deck.pop())) }
      // put initial discard that is not wild4
      let top = state.deck.pop(); while(top.type==='wild4'){ state.deck.unshift(top); top = state.deck.pop() }
      state.discard.push(top);
      renderAll(); log('Game dimulakan (local)');
    }

    function generateId(){ return Math.random().toString(36).slice(2,8) }

    function renderAll(){ UI.deckCount.textContent = state.deck.length; UI.discardTop.textContent = describeCard(state.discard[state.discard.length-1]); UI.lastAction.textContent = state.lastAction; UI.currentPlayerEl.textContent = state.players[state.turn]?.name || '-'; UI.directionEl.textContent = state.dir===1? '→':'←';
      renderPlayersList(); renderHand(); renderDiscard(); }

    function describeCard(c){ if(!c) return '-'; if(c.type==='number') return `${c.color} ${c.value}`; if(c.type==='wild') return 'WILD'; if(c.type==='wild4') return 'WILD+4'; return `${c.color} ${c.type}` }

    function renderHand(){ UI.hand.innerHTML=''; const me = state.players[0]; if(!me) return; me.hand.forEach((card,idx)=>{ const el=document.createElement('div'); el.className='card'; el.innerHTML = (card.type==='number'? card.value : (card.type==='wild'?'WILD': card.type)); el.onclick = ()=>tryPlayCard(0, idx); UI.hand.appendChild(el) }); }

    function renderPlayersList(){ UI.playersEl.innerHTML=''; state.players.forEach((p,i)=>{ const row = document.createElement('div'); row.className='player-row'; row.innerHTML = `<div style="font-weight:700">${p.name}</div><div class="meta">(${p.hand.length} kad)</div>`; if(i===state.turn) row.style.outline='2px solid rgba(255,255,255,0.06)'; UI.playersEl.appendChild(row) }) }
    function renderDiscard(){ const top = state.discard[state.discard.length-1]; UI.discardCard.textContent = describeCard(top) }

    function tryPlayCard(playerIndex, cardIndex){ if(playerIndex!==0) return; if(state.turn!==0){ log('Bukan giliran anda'); return } const card = state.players[playerIndex].hand[cardIndex]; if(canPlay(card)){ playCard(playerIndex, cardIndex); } else { log('Kad tak boleh main') } }

    function canPlay(card){ const top = state.discard[state.discard.length-1]; if(!card || !top) return true; if(card.type==='wild' || card.type==='wild4') return true; if(card.type==='number' && top.type==='number') return card.color===top.color || card.value===top.value; if(card.color && top.color && card.color===top.color) return true; if(card.type===top.type && (card.type==='skip' || card.type==='reverse' || card.type==='draw2')) return true; return false }

    function playCard(playerIndex, cardIndex, chosenColor=null){ const player = state.players[playerIndex]; const card = player.hand.splice(cardIndex,1)[0]; state.discard.push(card); state.lastAction = `${player.name} played ${describeCard(card)}`; log(state.lastAction);
      // effects
      if(card.type==='reverse'){ state.dir *= -1 }
      if(card.type==='skip'){ state.turn = nextTurnIndex(state.turn); }
      if(card.type==='draw2'){ const target = nextTurnIndex(state.turn); drawMultiple(target,2) }
      if(card.type==='wild4'){ // choose color (implement simple prompt)
        const color = chosenColor || prompt('Pilih color (red,green,blue,yellow) untuk wild') || 'red'; state.discard[state.discard.length-1].chosen = color; const target = nextTurnIndex(state.turn); drawMultiple(target,4) }
      if(card.type==='wild'){ const color = chosenColor || prompt('Pilih color (red,green,blue,yellow) untuk wild') || 'red'; state.discard[state.discard.length-1].chosen = color }

      // check uno penalty
      if(player.hand.length===1){ log(player.name + ' tinggal 1 kad — jangan lupa tekan UNO!') }
      if(player.hand.length===0){ state.isGame=false; log(player.name + ' menang!'); }

      // advance turn
      if(state.isGame){ state.turn = nextTurnIndex(state.turn); }
      renderAll();
      // if multiplayer: broadcast state
      broadcastState();
    }

    function drawMultiple(playerIdx, count){ for(let i=0;i<count;i++){ if(state.deck.length===0) refillDeck(); state.players[playerIdx].hand.push(state.deck.pop()) } log(`${state.players[playerIdx].name} draw ${count}`); }
    function nextTurnIndex(i){ const n=state.players.length; return ((i + state.dir + n) % n) }
    function refillDeck(){ const top = state.discard.pop(); state.deck = shuffle(state.discard); state.discard = [top]; }

    document.getElementById('newGameBtn').onclick = ()=> startLocalGame(['You','Bot 1','Bot 2']);
    document.getElementById('drawBtn').onclick = ()=>{ if(state.turn!==0){ log('Bukan giliran anda'); return } if(state.deck.length===0) refillDeck(); state.players[0].hand.push(state.deck.pop()); state.lastAction='You draw 1'; state.turn = nextTurnIndex(state.turn); renderAll(); broadcastState(); }
    document.getElementById('passBtn').onclick = ()=>{ document.getElementById('drawBtn').click() }
    document.getElementById('unoBtn').onclick = ()=>{ log('Anda tekan UNO! (dicatat)'); }

    // --- Multiplayer via PeerJS (simple) ---
    let peer = null; let connections = []; let isHost=false;
    document.getElementById('createRoomBtn').onclick = ()=>{
      if(peer){ peer.destroy(); peer=null }
      peer = new Peer();
      peer.on('open', id=>{
        isHost=true; document.getElementById('roomCode').textContent = id; UI.status.textContent='hosting'; log('Host id: '+id) });
      peer.on('connection', conn=>{
        connections.push(conn); updatePeersCount(); log('Peer connected: '+conn.peer);
        conn.on('data', data=> handlePeerData(conn, data));
        // send current state to new peer
        conn.on('open', ()=> conn.send({type:'stateSync',state:serializeStateForPeer()}))
      });
      peer.on('disconnected', ()=> log('Peer disconnected'));
    }

    document.getElementById('joinRoomBtn').onclick = ()=>{
      const code = document.getElementById('joinCode').value.trim(); if(!code) return; if(peer){ peer.destroy(); peer=null }
      peer = new Peer(); peer.on('open', ()=>{ UI.roomCode.textContent = 'joined'; UI.status.textContent='joined'; log('Local peer ready: '+peer.id); const conn = peer.connect(code); conn.on('open', ()=>{ connections.push(conn); updatePeersCount(); conn.on('data', d=> handlePeerData(conn,d)); log('Connected to host'); conn.send({type:'hello',name: 'Player-'+peer.id}) }); });
    }

    function updatePeersCount(){ UI.peersCount.textContent = connections.length }

    function serializeStateForPeer(){ // send minimal: players (names and hand counts), deckCount, discard top
      return {players: state.players.map(p=>({id:p.id,name:p.name,handCount:p.hand.length})),deckCount:state.deck.length,discardTop:state.discard[state.discard.length-1]}
    }

    function handlePeerData(conn,data){ if(!data) return; if(data.type==='stateSync'){ log('Menerima state sync'); // basic replace of players
        // for joiner: show remote players
        if(!isHost){ state.players = [{id:generateId(),name:'You',hand:[]}]; // host will define others
          // add remote players from host
          data.state.players.forEach(p=> state.players.push({id:p.id,name:p.name,hand: Array(p.handCount).fill({type:'unknown'})})); state.deck = Array(data.state.deckCount).fill(null); state.discard = [data.state.discardTop]; renderAll(); }
      }
      if(data.type==='chat'){ log(`[${conn.peer}] ${data.msg}`) }
      if(data.type==='action' && isHost){ // host applies actions then broadcast
        log('Host terima action '+ JSON.stringify(data.action)); applyRemoteAction(conn.peer, data.action); broadcastState(); }
    }

    function applyRemoteAction(peerId, action){ // minimal: support 'draw' or 'play' but only host should handle this
      const pIdx = state.players.findIndex(p=>p.name===action.playerName);
      if(pIdx===-1) return; if(action.cmd==='draw'){ if(state.deck.length===0) refillDeck(); state.players[pIdx].hand.push(state.deck.pop()); state.lastAction = `${action.playerName} draw 1` }
      if(action.cmd==='play'){ // host will just remove a card from player's hand count and push placeholder to discard
        state.players[pIdx].hand.pop(); state.discard.push({type:action.card.type,color:action.card.color,value:action.card.value}); state.lastAction = `${action.playerName} played ${describeCard(action.card)}` }
    }

    function broadcastState(){ if(!isHost) return; const s = serializeStateForPeer(); connections.forEach(c=> c.send({type:'stateSync',state:s})); }

    // small helper: copy room code
    document.getElementById('copyRoom').onclick = ()=>{ const code = document.getElementById('roomCode').textContent; navigator.clipboard?.writeText(code); log('Room code copied'); }
    document.getElementById('leaveBtn').onclick = ()=>{ if(peer){ peer.destroy(); peer=null; connections=[]; UI.roomCode.textContent='-'; UI.status.textContent='idle'; updatePeersCount(); log('Left room') } }

    // On page load: start a tiny local game stub
    startLocalGame(['You']);

  </script></body>
</html>